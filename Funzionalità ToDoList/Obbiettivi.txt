-togliere dalle completate aggiunta e modifica

CREATE OR ALTER TRIGGER trg_AggiornaSottoTaskStato
ON Task
AFTER UPDATE
AS
BEGIN
    -- Completa tutte le sotto-task se la task è stata completata (da 0 → 1)
    UPDATE ST
    SET ST.Stato = 1
    FROM SottoTask ST
    INNER JOIN inserted i ON ST.TaskID = i.Id
    INNER JOIN deleted d ON d.Id = i.Id
    WHERE i.Stato = 1 AND d.Stato <> 1;

    -- Riapre tutte le sotto-task se la task è stata riaperta (da 1 → 0)
    UPDATE ST
    SET ST.Stato = 0
    FROM SottoTask ST
    INNER JOIN inserted i ON ST.TaskID = i.Id
    INNER JOIN deleted d ON d.Id = i.Id
    WHERE i.Stato = 0 AND d.Stato <> 0;
END;
